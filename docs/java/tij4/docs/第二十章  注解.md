注解（也称作元数据）为我们在代码中添加信息提供了一种形式化的方法，使我们可以在稍后某个时刻非常方便地使用这些数据。

注解在一定程度上是在把元数据与源代码文件结合在一起，而不是保存在外部文档中这一趋势之下所催生的。

注解使得我们能够以将由编译器来测试和验证的格式，存储有关程序的额外信息。注解可以用来生成描述符文件，甚至或是新的类定义，并且有助于减轻编写样板代码的负担。更加干净易读的代码以及编译器类型检查。

Java SE5中内置了三种，定义在java.lang中的注解。



- @Override
- @Deprecated
- @SuppressWarnings

每当你创建描述符性质的类或接口时，一旦其中包含了重复性的工作，那就可以考虑使用主键来简化与自动化该过程。

注解是真正的语言级的概念，一旦构造出来，就享有编译器的类型检查保护。注解是在实际的源代码级别保存所有的信息，而不是某种注释性的文字，这使得代码更整洁，更便于维护。通过使用扩展的annotation API，

或外部的字节码工具类库，程序员拥有对源代码以及字节码强大的检查和操作能力。

## 1. 基本语法

### 1.1 定义注解

注解的定义看起来很像接口的定义。事实上，与其他任何Java接口一样，注解也将会便以为class文件。

在注解中一般都会包含一些元素以表示某些值。当分析处理注解时，程序或工具可以李咏这些值。注解的元素看起来就像接口的方法，唯一的区别是你可以为其指定默认值。没有元素的注解称为标记注解。

### 1.2 元注解

- @Target（该注解可以用在哪些地方）
- @Retention（需要在什么级别保存该注解信息）
- @Documented（将此注解包含在Javadoc中）
- @Inherited（允许子类继承父类的注解）

## 2. 编写注解处理器

如果没有用来读取注解的工具，那么注解也不会比注释更有用。使用注解的过程中，很重要的一个部分就是创建与使用注解处理器。Java SE5扩展了反射机制的API，以帮助程序员构造这类工具。同时，他还提供了一个外部工具apt来帮助程序员解析带有注解的Java源代码。

- getDeclaredMethods()
- getAnnotation()

### 2.1 注解元素

注解元素可用的类型如下：

- 所有基本类型（int，float，boolean等）
- String
- Class
- enum
- Annotation（注解可以嵌套）
- 以上类型的数组

不允许使用包装类型。

### 2.2 默认值限制

元素不能有不确定的值，要么具有默认值，要么使用注解时提供元素的值。

对于非基本类型的元素，无论在源代码声明中，或是在注解接口中定义默认值时，都不能以null作为其值。

在每个注解的声明中，所有的元素都存在，并且都具有相应的值。为了绕开这个约束，我们只能自己定义一些特殊的值，例如空字符串或负数，以此表示某个元素不存在。

### 2.3 生成外部文件

可以只指定enum ElementType中的某一个值，或者以逗号分隔的形式指定多个值。如果想要将注解应用于所有的ElementType，那么可以省去@Target元注解，不过这个并不常见。

快捷方式：如果注解中定义了名为value的元素，并且在应用该注解的时候，该元素是唯一需要赋值的一个元素，那么此时无需使用名-值对的这种语法，而只需在括号内给出value元素所需的值即可。

编译器允许程序员对一个目标同时使用多个注解，但是同一个注解不能重复使用。

### 2.4 注解不支持继承

不能使用关键字extends来继承某个@interface

### 2.5 实现处理器

## 3. 使用apt处理注解

注解处理工具apt，是Sun为了帮助注解的处理过程而提供的工具。

与javac一样，apt被设计为操作Java源文件，而不是编译后的类。

## 4. 将观察者模式用于apt

一个访问者会遍历某个数据结构或一个对象的集合，对其中的每一个对象执行一个操作。该数据结构无需有序，而你对每个对象执行的操作，都是特定于此对象的类型。这就将操作与对象解耦，也就是说，你可以添加新的操作，而无需向类的定义中添加方法。